{
  "scenarioTemplate": {
    "name": "Погода зависимое управление",
    "desc": "Задает уставку теплоносителя в зависимости от температуры наружнего воздуха",
    "active": true,
    "onStart": true,
    "sync": false,
    "data": "info = {\r\n    name: \"Погодазависимое управление\",\r\n    description: \"Задает уставку теплоносителя в зависимости от температуры наружнего воздуха\",\r\n    version: \"1.5\",\r\n    author: \"@vaneka97\",\r\n    onStart: true,\r\n}\r\n\r\nfunction weatherDependentControlcalculate(outdoorTemperatureID, sorceDeviceID, heatingCurve) {\r\n    //Проверка на корректность датчика температуры\r\n    if (!outdoorTemperatureID) {\r\n        log.error(\"Погодазависимое управление: Не передан идетификатор датчика температуры!\");\r\n        return;\r\n    } else if (Hub.getAccessory(outdoorTemperatureID) == null) {\r\n        log.error(\"Погодазависимое управление: По заданному идетификатору датчик тепературы не найден!\");\r\n        return;\r\n    } else if (Hub.getAccessory(outdoorTemperatureID).getService(HS.TemperatureSensor) == null) {\r\n        log.error(\"Погодазависимое управление: Устройство по заданному идетификатору не является датчиком тепературы!\");\r\n        return;\r\n    }\r\n    //Проверка на корректность нагревателя\r\n    if (!sorceDeviceID) {\r\n        log.error(\"Погодазависимое управление: Не передан идетификатор нагревателя!\");\r\n        return;\r\n    } else if (Hub.getAccessory(sorceDeviceID) == null) {\r\n        log.error(\"Погодазависимое управление: По заданному идетификатору нагреватель не найден!\");\r\n        return;\r\n    } else if (Hub.getAccessory(sorceDeviceID).getService(HS.HeaterCooler) == null) {\r\n        log.error(\"Погодазависимое управление: Устройство по заданному идетификатору не является нагреватлем!\");\r\n        return;\r\n    }\r\n\r\n    //Если коэффициент отопительной кривой не передан ставим 1.2\r\n    if(!heatingCurve){\r\n        heatingCurve = 1.0;\r\n    }\r\n\r\n    //Получаем температуру наружного воздуха\r\n    let outdoortemperature = Hub.getAccessory(outdoorTemperatureID).getService(HS.TemperatureSensor).getCharacteristic(HC.CurrentTemperature).getValue();\r\n\r\n    //Расчет температуры\r\n    let a, b, c, x, targetTemperature;\r\n    x = (-0.2 * outdoortemperature) + 5;\r\n    a = (-0.21 * heatingCurve) - 0.06;\r\n    b = (6.04 * heatingCurve) + 1.98;\r\n    c = (-5.06 * heatingCurve) + 18.06;\r\n\r\n    targetTemperature = (a * x * x) + (b * x) + c;\r\n\r\n    //Запись тепературы в параметр нагревателя\r\n    Hub.getAccessory(sorceDeviceID).getService(HS.HeaterCooler).getCharacteristic(HC.TargetTemperature).setValue(targetTemperature);\r\n\r\n}",
    "type": "GLOBAL"
  }
}